

SELECT B.CART_ID,
       SUM(CASE WHEN A.PRICE >= B.MINIMUM_REQUIREMENT THEN 1 ELSE 0 END) AS ABUSED
  FROM COUPONS B,
       (SELECT CART_ID, SUM(PRICE) AS PRICE
          FROM CART_PRODUCTS
         GROUP BY CART_ID) A
 WHERE A.CART_ID = B.CART_ID
 GROUP BY B.CART_ID

 id	cart_id	minimum_requirement	discount_amount
0	287	100000	9000
1	286	100000	9000
2	636	50000	3000
3	977	100000	6000
4	1091	200000	14000
5	448	100000	7000